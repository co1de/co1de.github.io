<!-- build time:Mon Jun 03 2019 22:43:02 GMT+0800 (中国标准时间) --><!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script><link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"><link rel="stylesheet" href="/css/main.css?v=6.7.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0"><link rel="icon" type="image/png" sizes="32x32" href="/images/run32.png?v=6.7.0"><link rel="icon" type="image/png" sizes="16x16" href="/images/run16.png?v=6.7.0"><link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222"><script id="hexo.configurations">var NexT=window.NexT||{},CONFIG={root:"/",scheme:"Pisces",version:"6.7.0",sidebar:{position:"left",display:"post",offset:12,b2t:!1,scrollpercent:!0,onmobile:!1},fancybox:!1,fastclick:!1,lazyload:!1,tabs:!0,motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},algolia:{applicationID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}}}</script><meta name="description" content="一些旧文章，因为一些原因内容有删减，发出来鞭尸。0.工具及环境环境：实验室服务器，装有xenserver，虚拟节点为centos工具：windows下Xencenter，自动化部署安装Ambari脚本1.安装centos虚拟机首先在服务器上安装centos虚拟机，将服务器划开。1.1 windows下共享iso文件夹XenServer 定义了一个名为存储库(SR) 的容器来描述存储虚拟磁盘映像 ("><meta name="keywords" content="Hadoop集群搭建"><meta property="og:type" content="article"><meta property="og:title" content="在XenServer环境下搭建Hadoop集群"><meta property="og:url" content="http://yoursite.com/2019/06/03/在XenServer环境下搭建Hadoop集群/index.html"><meta property="og:site_name" content="co1de&#39;s blogs"><meta property="og:description" content="一些旧文章，因为一些原因内容有删减，发出来鞭尸。0.工具及环境环境：实验室服务器，装有xenserver，虚拟节点为centos工具：windows下Xencenter，自动化部署安装Ambari脚本1.安装centos虚拟机首先在服务器上安装centos虚拟机，将服务器划开。1.1 windows下共享iso文件夹XenServer 定义了一个名为存储库(SR) 的容器来描述存储虚拟磁盘映像 ("><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://yoursite.com/images/pasted-14.png"><meta property="og:image" content="http://yoursite.com/images/pasted-15.png"><meta property="og:image" content="http://yoursite.com/images/pasted-16.png"><meta property="og:image" content="http://yoursite.com/images/pasted-17.png"><meta property="og:image" content="http://yoursite.com/images/pasted-18.png"><meta property="og:image" content="http://yoursite.com/images/pasted-19.png"><meta property="og:image" content="http://yoursite.com/images/pasted-20.png"><meta property="og:image" content="http://yoursite.com/images/pasted-21.png"><meta property="og:image" content="http://yoursite.com/images/pasted-22.png"><meta property="og:image" content="http://yoursite.com/images/pasted-23.png"><meta property="og:image" content="http://yoursite.com/images/pasted-24.png"><meta property="og:image" content="http://yoursite.com/images/pasted-25.png"><meta property="og:image" content="http://yoursite.com/images/pasted-26.png"><meta property="og:image" content="http://yoursite.com/images/pasted-28.png"><meta property="og:image" content="http://yoursite.com/images/pasted-29.png"><meta property="og:image" content="http://yoursite.com/images/pasted-30.png"><meta property="og:image" content="http://images/pasted-31.png/"><meta property="og:image" content="http://yoursite.com/images/pasted-32.png"><meta property="og:image" content="http://yoursite.com/images/pasted-33.png"><meta property="og:image" content="http://yoursite.com/images/pasted-34.png"><meta property="og:image" content="http://yoursite.com/images/pasted-35.png"><meta property="og:image" content="http://yoursite.com/images/pasted-36.png"><meta property="og:image" content="http://yoursite.com/images/pasted-37.png"><meta property="og:image" content="http://yoursite.com/images/pasted-38.png"><meta property="og:image" content="http://yoursite.com/images/pasted-39.png"><meta property="og:updated_time" content="2019-06-03T14:42:37.625Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="在XenServer环境下搭建Hadoop集群"><meta name="twitter:description" content="一些旧文章，因为一些原因内容有删减，发出来鞭尸。0.工具及环境环境：实验室服务器，装有xenserver，虚拟节点为centos工具：windows下Xencenter，自动化部署安装Ambari脚本1.安装centos虚拟机首先在服务器上安装centos虚拟机，将服务器划开。1.1 windows下共享iso文件夹XenServer 定义了一个名为存储库(SR) 的容器来描述存储虚拟磁盘映像 ("><meta name="twitter:image" content="http://yoursite.com/images/pasted-14.png"><link rel="canonical" href="http://yoursite.com/2019/06/03/在XenServer环境下搭建Hadoop集群/"><script id="page.configurations">CONFIG.page={sidebar:""}</script><title>在XenServer环境下搭建Hadoop集群 | co1de's blogs</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-title,.use-motion .comments,.use-motion .menu-item,.use-motion .motion-element,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN"><div class="container sidebar-position-left page-post-detail"><div class="headband"></div><a href="https://github.com/co1de" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513;color:#fff;position:absolute;top:0;border:0;right:0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">co1de's blogs</span> <span class="logo-line-after"><i></i></span></a></div><p class="site-subtitle">记录个人工作生活</p></div><div class="site-nav-toggle"><button aria-label="切换导航栏"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于</a></li></ul></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/03/在XenServer环境下搭建Hadoop集群/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="co1de"><meta itemprop="description" content="保持好奇心，提高行动力"><meta itemprop="image" content="/images/run.jpg"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="co1de's blogs"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">在XenServer环境下搭建Hadoop集群</h1><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2019-06-03 21:54:00 / 修改时间：22:42:37" itemprop="dateCreated datePublished" datetime="2019-06-03T21:54:00+08:00">2019-06-03</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Hadoop集群搭建/" itemprop="url" rel="index"><span itemprop="name">Hadoop集群搭建</span></a></span> </span><span class="post-comments-count"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><a href="/2019/06/03/在XenServer环境下搭建Hadoop集群/#comments" itemprop="discussionUrl"><span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/03/在XenServer环境下搭建Hadoop集群/" itemprop="commentCount"></span> </a></span><span id="/2019/06/03/在XenServer环境下搭建Hadoop集群/" class="leancloud_visitors" data-flag-title="在XenServer环境下搭建Hadoop集群"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> 次</span><div class="post-symbolscount"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span title="本文字数">4.7k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span title="阅读时长">4 分钟</span></div></div></header><div class="post-body" itemprop="articleBody"><h2 id="一些旧文章，因为一些原因内容有删减，发出来鞭尸。"><a href="#一些旧文章，因为一些原因内容有删减，发出来鞭尸。" class="headerlink" title="一些旧文章，因为一些原因内容有删减，发出来鞭尸。"></a>一些旧文章，因为一些原因内容有删减，发出来鞭尸。</h2><h1 id="0-工具及环境"><a href="#0-工具及环境" class="headerlink" title="0.工具及环境"></a>0.工具及环境</h1><p>环境：实验室服务器，装有xenserver，虚拟节点为centos<br>工具：windows下Xencenter，自动化部署安装Ambari脚本</p><h1 id="1-安装centos虚拟机"><a href="#1-安装centos虚拟机" class="headerlink" title="1.安装centos虚拟机"></a>1.安装centos虚拟机</h1><p>首先在服务器上安装centos虚拟机，将服务器划开。</p><h2 id="1-1-windows下共享iso文件夹"><a href="#1-1-windows下共享iso文件夹" class="headerlink" title="1.1 windows下共享iso文件夹"></a>1.1 windows下共享iso文件夹</h2><p>XenServer 定义了一个名为存储库(SR) 的容器来描述存储虚拟磁盘映像 (VDI) 的特定存储目标。<br>XenServer不同于VM可以直接导入iso，在windows环境下需要使用共享文件夹的方式共享iso，在linux环境下需要使用nfs的方式共享iso。这里我们都是在windows环境下管理，因此记录下windows下的管理方式。<br>选择存有iso的文件夹进行共享。<br><img src="\images\pasted-14.png" alt="upload successful"></p><h2 id="1-2-在XenCenter中新建SR"><a href="#1-2-在XenCenter中新建SR" class="headerlink" title="1.2 在XenCenter中新建SR"></a>1.2 在XenCenter中新建SR</h2><h3 id="1-2-1-首先需要先新建一个sr"><a href="#1-2-1-首先需要先新建一个sr" class="headerlink" title="1.2.1 首先需要先新建一个sr"></a>1.2.1 首先需要先新建一个sr</h3><p><img src="\images\pasted-15.png" alt="upload successful"></p><h3 id="1-2-2-选择iso库中的windows文件共享"><a href="#1-2-2-选择iso库中的windows文件共享" class="headerlink" title="1.2.2 选择iso库中的windows文件共享"></a>1.2.2 选择iso库中的windows文件共享</h3><p><img src="\images\pasted-16.png" alt="upload successful"></p><h3 id="1-2-3-注意网络位置"><a href="#1-2-3-注意网络位置" class="headerlink" title="1.2.3 注意网络位置"></a>1.2.3 注意网络位置</h3><p>直接复制过来的共享路径可能无法解析dns，最好将主机名改为ip。账号登陆是为了安全，一般用当前windows账号就可以。<br><img src="\images\pasted-17.png" alt="upload successful"><br>如果使用的是<strong>微软帐号</strong>登陆，请使用邮箱和密码登陆。</p><p><img src="\images\pasted-18.png" alt="upload successful"><br>连接成功后我们可以在侧边栏看到新添加的库</p><p><img src="\images\pasted-19.png" alt="upload successful"></p><h3 id="1-2-4-可能出现的问题"><a href="#1-2-4-可能出现的问题" class="headerlink" title="1.2.4 可能出现的问题"></a>1.2.4 可能出现的问题</h3><p>在新建sr中可能会出现连接不上的问题，这里给出几个参考，可以尝试能否解决。</p><ul><li>检查windows smb服务<br>本人的连接问题即windows 10更新后smb服务默认是没开启的，各种连不上，开启服务后一切正常。<br>步骤：控制面板-&gt;程序-&gt;启用或关闭windows功能<br>若没有开启勾选安装完成后重启即可。</li></ul><p><img src="\images\pasted-20.png" alt="upload successful"></p><ul><li>检查组策略编辑器<br>本人问题是在第一个方法完成后就解决了，这里方法仅供参考。<br>运行gpedit.msc<br><img src="\images\pasted-21.png" alt="upload successful"><br>检查框选的两个部分，第一个部分中应有前面要登陆的账户，没有则添加，第二个部分可以选择清空处理。<h2 id="1-3-开始安装虚拟机"><a href="#1-3-开始安装虚拟机" class="headerlink" title="1.3 开始安装虚拟机"></a>1.3 开始安装虚拟机</h2><h3 id="1-3-1-准备安装环境"><a href="#1-3-1-准备安装环境" class="headerlink" title="1.3.1 准备安装环境"></a>1.3.1 准备安装环境</h3>这里我们可以不用已有模板，选择最后的other install media，这样可以使用图形化界面进行安装。</li></ul><p><img src="\images\pasted-22.png" alt="upload successful"><br>这里我们可以选择刚才添加的iso库。</p><p><img src="\images\pasted-23.png" alt="upload successful"><br>后面的步骤省略，都为自定义配置部分。<br>配置完毕后可在vm的控制台中配置安装过程。</p><blockquote><p>一个问题：<br>使用other install media 模板。每次都停在 mounting /tmp as tmpfs… done<br>谷歌路径;<a href="javascript:void(" target="_blank" rel="noopener">http://serverfault.com/questions/535492/rhel-clones-centos-scientific-cern-network-installation-on-xenserver-6-2</a>) 里找到答案。<br>解决方案：<br>进入Xenserver宿主机，<br>首先通过xe vm-list获取UUID<br>然后再执行xe vm-param-set uuid=uuid_of_your_virtual_machine platform:viridian=false<br>接着重新启动你要安装的那个系统</p></blockquote><h3 id="1-3-2-配置系统参数"><a href="#1-3-2-配置系统参数" class="headerlink" title="1.3.2 配置系统参数"></a>1.3.2 配置系统参数</h3><p>安装过程省略。</p><h3 id="1-3-3-安装xentool"><a href="#1-3-3-安装xentool" class="headerlink" title="1.3.3 安装xentool"></a>1.3.3 安装xentool</h3><p>为方便管理，可考虑安装xentool，它还有其余优化功能,比如在网络连接里可以看到ip地址等，此处不赘述<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/cdrom /mnt</span><br><span class="line">/mnt/Linux/install.sh</span><br></pre></td></tr></table></figure><p></p><h3 id="1-3-4-配置网络"><a href="#1-3-4-配置网络" class="headerlink" title="1.3.4 配置网络"></a>1.3.4 配置网络</h3><p>配置文件路径在 /etc/sysconfig/network-scripts/ 下，找到想使用的默认网卡，进入修改配置。<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DEVICE=eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">UUID=81a678ea-81fa-4015-b6be-edea9f1c1ec3</span><br><span class="line">ONBOOT=yes  #需要设置为yes，否则找不到网卡</span><br><span class="line">NM_CONTROLLED=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.0.51</span><br><span class="line">#基本上PREFIX = 16与NETMASK 255.255.0.0相同，PREFIX = 24与NETMASK 255.255.255.0相同</span><br><span class="line">PREFIX=16 #该属性要与netmask正确组合，否则会出现网卡不能使用的问题！！直接使用netmask最好</span><br><span class="line">GATEWAY=192.168.1.1</span><br><span class="line">DNS1=1.1.1.1 #dns设置，可以多设置几个</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=&quot;System eth0&quot;</span><br><span class="line">HWADDR=FE:B8:DE:D1:DA:D0</span><br></pre></td></tr></table></figure><p></p><h2 id="1-4-复制多个虚拟机"><a href="#1-4-复制多个虚拟机" class="headerlink" title="1.4 复制多个虚拟机"></a>1.4 复制多个虚拟机</h2><h3 id="1-4-1-复制"><a href="#1-4-1-复制" class="headerlink" title="1.4.1 复制"></a>1.4.1 复制</h3><p>XenCenter支持快速复制多个虚拟机，选择合适的模式即可。</p><p><img src="\images\pasted-24.png" alt="upload successful"></p><blockquote><p>可以通过复制（兊隆）现有 VM 的方式创建新的 VM。 XenServer 使用完成复制和快速兊隆返两种机制<br>来复制 VM：<br>􀀀 完整复制生成 VM 磁盘的完整副本；<br>􀀀 快速兊隆（写入时复制）仅将修改的数据块写入磁盘，使用硬件级别的兊隆功能将现有 VM 中的磁盘<br>复制到新 VM。只有采用文件作为后端的 VM 才支持此模式。写入时复制旨在节省磁盘空间并实现快速兊<br>隆，但会略微减低正常的磁盘性能。<br>只能在同一个资源池中直接复制 VM。要将 VM 复制到其他池中的服务器，需要导出 VM，然后再将其导<br>入目标服务器。</p></blockquote><h3 id="1-4-2-配置"><a href="#1-4-2-配置" class="headerlink" title="1.4.2 配置"></a>1.4.2 配置</h3><p>复制完成后我们需要调整网卡和主机名<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network</span><br><span class="line"><span class="meta">#</span>修改hostname值</span><br><span class="line"></span><br><span class="line">ifconfig eht0 #查看网卡mac地址</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"><span class="meta">#</span>修改HWADDR的值为mac地址</span><br><span class="line">service network restart</span><br></pre></td></tr></table></figure><p></p><h1 id="2-执行ambari自动部署脚本（略）"><a href="#2-执行ambari自动部署脚本（略）" class="headerlink" title="2.执行ambari自动部署脚本（略）"></a>2.执行ambari自动部署脚本（略）</h1><p>这里大家可以自行寻找符合要求的自动化部署脚本。我们这里采用了离线部署的方式。简单列出思路</p><ol><li>在NameNode上搭建ftp服务器（或http都可）</li><li>将hortonworks的工具包拷入服务器目录</li><li>将centos的离线包环境拷入节点仓库，即替换repo</li><li>修改所有节点hosts</li><li>配置所有节点ssh免密</li><li>配置节点ntp同步</li><li>关闭selinux</li><li>关闭防火墙</li><li>关闭packagekit</li><li>统一安装jdk</li><li>安装ambari-server</li><li>设置开机自启动ftp、ntp、ambari服务</li></ol><h1 id="3-安装HDP"><a href="#3-安装HDP" class="headerlink" title="3.安装HDP"></a>3.安装HDP</h1><h2 id="3-1-配置Ambari"><a href="#3-1-配置Ambari" class="headerlink" title="3.1 配置Ambari"></a>3.1 配置Ambari</h2><p>在上一步执行了Ambari-server setup后，有些简单的配置，这里说一下<br><img src="\images\pasted-25.png" alt="upload successful"><br>若没重启，selinux很可能没关闭，这时选继续（y）会临时关闭，密码直接回车就好，默认账户，jdk选择自定义输入自己的路径即可。</p><p><img src="\images\pasted-26.png" alt="upload successful"><br>数据库这里我们用默认的postgresql，存储密码等信息，网上有使用mysql的。可自行查阅，</p><h2 id="3-2-开始安装HDP"><a href="#3-2-开始安装HDP" class="headerlink" title="3.2 开始安装HDP"></a>3.2 开始安装HDP</h2><p>选关键部分进行截图说明</p><ul><li>开始安装<br><img src="\images\pasted-28.png" alt="upload successful"></li><li>可用公有仓库，但需要将地址修改为自己的ftp地址，总之是使用离线地址，即server发布的地址，这也就是为什么用ftp和httpd服务的原因了，可跳过验证<br><img src="\images\pasted-29.png" alt="upload successful"></li><li>添加集群列表，导入主节点ambari-server的id_rsa，为了后面装ambri-agent用</li></ul><p><img src="\images\pasted-30.png" alt="upload successful"></p><ul><li>输入相关组件默认密码，根据提示输入默认密码即可</li></ul><p><img src="\\images\pasted-31.png\" alt="upload successful"></p><ul><li>若在deploy时提示什么url错误的，先使用ambari-server stop -&gt; ambari-server reset -&gt;ambari-server start 重置一下应该能解决，忘了截图<h2 id="3-3-可能出现的问题"><a href="#3-3-可能出现的问题" class="headerlink" title="3.3 可能出现的问题"></a>3.3 可能出现的问题</h2>安装过程中可能会出现很多问题，注意看提示进行解决，<strong>centos6.4-hdp1.x</strong>版本时没出现问题。<br>这里我列出几个自己在<strong>centos7-hdp2.5</strong>环境遇到的问题。</li><li>datanode安装失败，查看提示信息，发现是snappy版本过高<br><img src="\images\pasted-32.png" alt="upload successful"><br>卸载新版本snappy，安装指定版本snappy</li></ul><p><img src="\images\pasted-33.png" alt="upload successful"><br>指定版本在所需工具中有，我们有离线源可以安装。</p><p><img src="\images\pasted-34.png" alt="upload successful"></p><h1 id="4-补充-配置本地源"><a href="#4-补充-配置本地源" class="headerlink" title="4.(补充)配置本地源"></a>4.(补充)配置本地源</h1><p>这里对整个过程做一个总结，并总结一下配置本地源的过程。</p><h2 id="4-1-自动化部署的思路"><a href="#4-1-自动化部署的思路" class="headerlink" title="4.1 自动化部署的思路"></a>4.1 自动化部署的思路</h2><p>总的来说就是在离线环境下安装Ambari和HDP集群。ftp文件夹下除了Ambari和hdp安装包，还需要一个系统镜像包，这是为了执行脚本时安装一些工具方便，比如vsftp和expect等。</p><ul><li>开启ftp服务，为了使用yum进行相关软件安装，为了安完Ambari后离线安装hdp，可以在网上看到有人也采用httpd方式，功能一样</li><li>配置ssh免密登陆，这是方便后续配置的方式，可见Hadoop机群搭建</li><li>ntp机群时间同步：必须步骤</li><li>关闭SElinux和iptables：防止出现一些不必要的拦截，关闭不是最好的方式，却是最简单有效的方式。</li><li>关闭packagekit：防止更新出现一些不可知的问题。</li></ul><h2 id="4-2-配置本地环境"><a href="#4-2-配置本地环境" class="headerlink" title="4.2 配置本地环境"></a>4.2 配置本地环境</h2><p>主要就是ftp目录下的几个文件来源</p><h3 id="4-2-1-OS"><a href="#4-2-1-OS" class="headerlink" title="4.2.1 OS"></a>4.2.1 OS</h3><p>系统依赖就是iso镜像下的这两个文件夹。</p><p><img src="\images\pasted-35.png" alt="upload successful"></p><h3 id="4-2-2-Ambari及hdp"><a href="#4-2-2-Ambari及hdp" class="headerlink" title="4.2.2 Ambari及hdp"></a>4.2.2 Ambari及hdp</h3><p>去官网<a href="https://docs.hortonworks.com" target="_blank" rel="noopener">https://docs.hortonworks.com</a> 下载tar包，解压即可，总共三个部分<br><img src="\images\pasted-36.png" alt="upload successful"><br><img src="\images\pasted-37.png" alt="upload successful"><br><img src="\images\pasted-38.png" alt="upload successful"></p><h3 id="4-3-3-配置repo包路径"><a href="#4-3-3-配置repo包路径" class="headerlink" title="4.3.3 配置repo包路径"></a>4.3.3 配置repo包路径</h3><p>前面提到过，在NameNode下有repo包，包中指定的路径为ftp服务路径，将其中所有路径改为正确的路径即可。</p><p><img src="\images\pasted-39.png" alt="upload successful"></p><h1 id="5-确认"><a href="#5-确认" class="headerlink" title="5.确认"></a>5.确认</h1><p>最后<strong>重启</strong>确保所有节点的<strong>时间同步，jdk一致，防火墙、selinux关闭、开机自启正常</strong>。</p><h1 id="6-踩坑记录"><a href="#6-踩坑记录" class="headerlink" title="6.踩坑记录"></a>6.踩坑记录</h1><h2 id="6-1-ssh不能登陆"><a href="#6-1-ssh不能登陆" class="headerlink" title="6.1 ssh不能登陆"></a>6.1 ssh不能登陆</h2><p>导致该问题的根源是，sshd守护进程不知怎么地不能加载SSH主机密钥了。<br>当OpenSSH服务器第一次安装到Linux系统时，SSH主机密钥应该会自动生成以供后续使用。如果，不管怎样，密钥生成过程没有成功完成，那就会导致这样的SSH登录问题。<br>若发现ssh不能登陆提示<strong>Read from socket failed: Connection reset by peer</strong><br>先去/var/log/messages下查看，若是发现类似提示<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Dec 15 19:44:56 localhost sshd[3136]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line">Dec 15 19:47:03 localhost sshd[3138]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line"></span><br><span class="line">Dec 15 19:47:03 localhost sshd[3138]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key</span><br><span class="line"></span><br><span class="line">#看缺少那个key，用下面命令生成</span><br><span class="line">ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</span><br><span class="line">ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key</span><br><span class="line">ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">ssh-keygen -t dsa -f /etc/ssh/ssh_host_ed25519_key</span><br></pre></td></tr></table></figure><p></p><h2 id="6-1用户问题"><a href="#6-1用户问题" class="headerlink" title="6.1用户问题"></a>6.1用户问题</h2><p>confirm hosts 步骤是默认使用root用户进行主机注册的。<br>如果使用脚本安装时不是root用户，即此时生成的ssh也不是root的，在ambari安装时记得先初始化设置用户为你使用的用户。</p></div><div><div><div style="text-align:center;color:#ccc;font-size:14px">-------------本文结束<i class="fa fa-heart"></i>感谢您的阅读-------------</div></div></div><div><div style="padding:10px 0;margin:20px auto;width:90%;text-align:center"><div>请作者喝冰阔落~</div><button id="rewardButton" disable="enable" onclick='var e=document.getElementById("QR");"none"===e.style.display?e.style.display="block":e.style.display="none"'><span>打赏</span></button><div id="QR" style="display:none"><div id="wechat" style="display:inline-block"><img id="wechat_qr" src="/images/wechatpay.jpg" alt="co1de 微信支付"><p>微信支付</p></div><div id="alipay" style="display:inline-block"><img id="alipay_qr" src="/images/alipay.jpg" alt="co1de 支付宝"><p>支付宝</p></div></div></div></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Hadoop集群搭建/" rel="tag"><i class="fa fa-tag"></i> Hadoop集群搭建</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/2019/06/03/VMware中Ubuntu下配置Hadoop环境/" rel="next" title="VMware中Ubuntu下配置Hadoop环境"><i class="fa fa-chevron-left"></i> VMware中Ubuntu下配置Hadoop环境</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"></div></div></footer></div></article></div></div><div class="comments" id="comments"></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">文章目录</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">站点概览</li></ul><div class="site-overview-wrap sidebar-panel"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/images/run.jpg" alt="co1de"><p class="site-author-name" itemprop="name">co1de</p><p class="site-description motion-element" itemprop="description">保持好奇心，提高行动力</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">5</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">3</span> <span class="site-state-item-name">标签</span></a></div></nav></div></div><div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active"><div class="post-toc"><div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一些旧文章，因为一些原因内容有删减，发出来鞭尸。"><span class="nav-number">1.</span> <span class="nav-text">一些旧文章，因为一些原因内容有删减，发出来鞭尸。</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#0-工具及环境"><span class="nav-number"></span> <span class="nav-text">0.工具及环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-安装centos虚拟机"><span class="nav-number"></span> <span class="nav-text">1.安装centos虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-windows下共享iso文件夹"><span class="nav-number">1.</span> <span class="nav-text">1.1 windows下共享iso文件夹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-在XenCenter中新建SR"><span class="nav-number">2.</span> <span class="nav-text">1.2 在XenCenter中新建SR</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-1-首先需要先新建一个sr"><span class="nav-number">2.1.</span> <span class="nav-text">1.2.1 首先需要先新建一个sr</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-2-选择iso库中的windows文件共享"><span class="nav-number">2.2.</span> <span class="nav-text">1.2.2 选择iso库中的windows文件共享</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-3-注意网络位置"><span class="nav-number">2.3.</span> <span class="nav-text">1.2.3 注意网络位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-4-可能出现的问题"><span class="nav-number">2.4.</span> <span class="nav-text">1.2.4 可能出现的问题</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-开始安装虚拟机"><span class="nav-number">3.</span> <span class="nav-text">1.3 开始安装虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-1-准备安装环境"><span class="nav-number">3.1.</span> <span class="nav-text">1.3.1 准备安装环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-2-配置系统参数"><span class="nav-number">3.2.</span> <span class="nav-text">1.3.2 配置系统参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-3-安装xentool"><span class="nav-number">3.3.</span> <span class="nav-text">1.3.3 安装xentool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-4-配置网络"><span class="nav-number">3.4.</span> <span class="nav-text">1.3.4 配置网络</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-复制多个虚拟机"><span class="nav-number">4.</span> <span class="nav-text">1.4 复制多个虚拟机</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-1-复制"><span class="nav-number">4.1.</span> <span class="nav-text">1.4.1 复制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-4-2-配置"><span class="nav-number">4.2.</span> <span class="nav-text">1.4.2 配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-执行ambari自动部署脚本（略）"><span class="nav-number"></span> <span class="nav-text">2.执行ambari自动部署脚本（略）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-安装HDP"><span class="nav-number"></span> <span class="nav-text">3.安装HDP</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-配置Ambari"><span class="nav-number">1.</span> <span class="nav-text">3.1 配置Ambari</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-开始安装HDP"><span class="nav-number">2.</span> <span class="nav-text">3.2 开始安装HDP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-可能出现的问题"><span class="nav-number">3.</span> <span class="nav-text">3.3 可能出现的问题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-补充-配置本地源"><span class="nav-number"></span> <span class="nav-text">4.(补充)配置本地源</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-自动化部署的思路"><span class="nav-number">1.</span> <span class="nav-text">4.1 自动化部署的思路</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-配置本地环境"><span class="nav-number">2.</span> <span class="nav-text">4.2 配置本地环境</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-OS"><span class="nav-number">2.1.</span> <span class="nav-text">4.2.1 OS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-Ambari及hdp"><span class="nav-number">2.2.</span> <span class="nav-text">4.2.2 Ambari及hdp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-3-配置repo包路径"><span class="nav-number">2.3.</span> <span class="nav-text">4.3.3 配置repo包路径</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-确认"><span class="nav-number"></span> <span class="nav-text">5.确认</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-踩坑记录"><span class="nav-number"></span> <span class="nav-text">6.踩坑记录</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-ssh不能登陆"><span class="nav-number">1.</span> <span class="nav-text">6.1 ssh不能登陆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1用户问题"><span class="nav-number">2.</span> <span class="nav-text">6.1用户问题</span></a></li></ol></li></div></div></div></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">co1de</span></div><span id="busuanzi_container_site_pv" class="theme-info">&nbsp;&nbsp;&nbsp;&nbsp;本站总访问量<span id="busuanzi_value_site_pv"></span>次 </span><span id="busuanzi_container_site_uv" class="theme-info">&nbsp;&nbsp;|&nbsp;&nbsp;本站访客数<span id="busuanzi_value_site_uv"></span>人次</span><div class="busuanzi-count"><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span id="scrollpercent"><span>0</span>%</span></div></div><script>"[object Function]"!==Object.prototype.toString.call(window.Promise)&&(window.Promise=null)</script><script color="0,0,255" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script><script src="/lib/jquery/index.js?v=2.1.3"></script><script src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/js/src/utils.js?v=6.7.0"></script><script src="/js/src/motion.js?v=6.7.0"></script><script src="/js/src/affix.js?v=6.7.0"></script><script src="/js/src/schemes/pisces.js?v=6.7.0"></script><script src="/js/src/scrollspy.js?v=6.7.0"></script><script src="/js/src/post-details.js?v=6.7.0"></script><script src="/js/src/bootstrap.js?v=6.7.0"></script><script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>var GUEST=["nick","mail","link"],guest="nick,mail,link";guest=guest.split(",").filter(function(e){return GUEST.indexOf(e)>-1}),new Valine({el:"#comments",verify:!1,notify:!1,appId:"XzkPRbve0eqeGrw5ijtR6uAT-gzGzoHsz",appKey:"mMouJAbT2QcNCH6RguUB9Lnt",placeholder:"Just go go",avatar:"mm",meta:guest,pageSize:"10",visitor:!1})</script><script>function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text(counter.time + 1);
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              Counter('post', '/classes/Counter', JSON.stringify({ title: title, url: url, time: 1 }))
                .done(function() {
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(1);
                })
                .fail(function() {
                  console.log('Failed to create');
                });
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'XzkPRbve0eqeGrw5ijtR6uAT-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'XzkPRbve0eqeGrw5ijtR6uAT-gzGzoHsz',
                'X-LC-Key': 'mMouJAbT2QcNCH6RguUB9Lnt',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });</script><script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script><script type="text/javascript" src="/js/src/clicklove.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({enabled:!0,tagMode:!0,display:{position:"right",width:75,height:150},mobile:{show:!1},log:!1,pluginJsPath:"lib/",pluginModelPath:"assets/",pluginRootPath:"live2dw/"})</script></body></html><!-- rebuild by neat -->